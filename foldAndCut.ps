% The shape operator draws a shape assuming that the shape is drawn in a
% 100 x 100 square.
/shape {
  1 dict begin
    gsave
      newpath
        100 0 moveto
        20 20 lineto
        25 30 lineto
        20 40 lineto
        25 50 lineto
        20 60 lineto
        0  100 lineto
        0 0 lineto
        80 0 lineto
      closepath
      fill
      stroke
    grestore
  end
} def

/foldAndCut {
    % Stack: n
    dup 0 eq {
        % --- Base Case: n = 0 ---
        pop         % Clean stack (remove n)
        shape   % Draw the actual shape
    } {
        % --- Recursive Step: n > 0 ---
        1 sub       % Decrement n for the next level (stack: n-1)
        
        gsave
            % 1. Scale down: Each fold makes the square 1/4 size (1/2 width, 1/2 height)
            0.5 0.5 scale
            
            % We simulate the fold by moving the origin to the center 
            % of the new 2x2 grid (Side, Side) relative to the scaled system.
            
            % --- Quadrant 1: Upper Right ---
            % "The upper right square will be the square that we cut"
            gsave
                100 100 translate
                dup foldAndCut  % Recurse with n-1
            grestore
            
            % --- Quadrant 2: Upper Left ---
            % "Mirror image (in the X-axis) of the upper right"
            gsave
                100 100 translate
                -1 1 scale      % Mirror X
                dup foldAndCut  % Recurse with n-1
            grestore
            
            % --- Quadrant 3: Lower Left ---
            % "Mirror image (in the Y-axis) of the upper left"
            % (Which is logically a 180 rotation of Upper Right)
            gsave
                100 100 translate
                -1 -1 scale     % Mirror X and Mirror Y
                dup foldAndCut  % Recurse with n-1
            grestore
            
            % --- Quadrant 4: Lower Right ---
            % "Mirror image (in the Y-axis) of the upper right"
            gsave
                100 100 translate
                1 -1 scale      % Mirror Y
                dup foldAndCut  % Recurse with n-1
            grestore
            
        grestore
        pop % Remove n-1 from stack
    } ifelse
} def

% Below here is the test code

/Times-Roman findfont        % Find the font 
20 scalefont                 % Make it a 50 point font
setfont                      % Now load the font as the current font

/print-top {                
%   160 0 moveto
   5 string                 % Create a string of length 10 on the operand stack
   cvs                       % Convert the top value of the stack to the string
   show
} def                        

% move coordinates
200 700 translate

% first test
0 0 moveto
(0 foldAndCut) show
0 -100 translate
0 foldAndCut stroke 
0 -20 translate
0 0 moveto
count print-top
( things left on the stack.) show

% move coordinates
0 -100 translate

% second test
0 0 moveto
(1 foldAndCut) show
0 -100 translate
1 foldAndCut stroke 
0 -20 translate
0 0 moveto
count print-top
( things left on the stack.) show

% move coordinates
0 -100 translate

% third test
0 0 moveto
(4 foldAndCut) show
0 -100 translate
4 foldAndCut stroke
0 -20 translate
0 0 moveto
count print-top
( things left on the stack.) show


